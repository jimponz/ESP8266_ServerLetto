

<!DOCTYPE HTML><html>
<head>
  
  <title>Letto</title>
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="crossorigin="anonymous"></script>
  <script src='https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js'></script>
  <link href='https://stackpath.bootstrapcdn.com/bootswatch/4.5.2/slate/bootstrap.min.css' rel='stylesheet'> 
  
</head>
<body>
 
  <div id='jsonInfo'>
			
  </div>
	
  <!-- <div class ="text-center" style="display:none" id="info">
  <br><a href="http://";
  ptr +=IPPub;
  "<h6>IP: 
  ptr += IPPub;
  </a><br> MAC: 
  ptr += MAC;
  </h6></div> -->
  
  <div class ="text-center m-3" id='fullPage'>
	  <br>
	  
	  <button type="button" id="oraServerOnline" onclick ="" class="btn rounded-pill btn-success text-white button-border-white "><strong> </strong></button>
		
	  <a href='Pannello'> <button id="buttonOrario" type="button" onclick ="move()" class="btn rounded-pill btn-light button-border-white"><strong> </strong></button></a>
	  
	  <!-- <button class="btn rounded-pill btn-info button-border-white " id ="buttonMemoria" ><strong>Memoria disponibile: </strong></button> -->
	  
	  <button class="btn rounded-pill btn-info button-border-white " id ="btnInfo" onclick="toggle_visibility('info')"><strong>Info</strong></button>
	  
	  <button type="button" onclick = "reboot()" class="btn rounded-pill btn-danger button-border-white "><strong>Riavvia</strong></button>
	  	  
	  
	  <br><br>
	  
	<div class="d-flex justify-content-between">
		<div class="float-left" >
	 	  	  
			<div class="d-inline-flex">
			  <div class="card text-white bg-primary mb-3" style="max-width: 17rem;">
				<div class="card-header"><h4>Altri Server:</h4></div>
				<div class="card-body" >			
					<a href="principale" ><button class="btn rounded-pill btn-warning button-border-white"><strong>Server Principale</strong></button></a>
					<br>
					<a href="scrivania"><button class="btn rounded-pill btn-success button-border-white"><strong>Server Scrivania</strong></button></a>
					<br>
					<a href="bagno"><button class="btn rounded-pill btn-info button-border-white"><strong>Server Bagno</strong></button></a>
					<br>
				
				</div> <!--  CHIUDE IL BODY DELLA CARD -->
			  </div> <!-- CHIUDE LA CARD -->
				  
			</div> <!-- CHIUDE ALTRO D INLINE FLEX -->
		
		</div>   <!-- CHIUDE D INLINE float LEFT -->
	 
	  <div class="float-center">
		  <div class="text-center">
			  <br>
			  <h2>DOMOTIK   LETTO</h2>
			  <br><br><br><br><br><br><br><br>
			  <h1 class="display-4 text-white">Pannello di controllo luci</h1>
			  <br>
			  
			  
		  </div>
	  </div>
	  <div class="float-right">
		  <div class="d-inline-flex">
			  <div class="card text-white bg-primary mb-3" style="max-width: 17rem;">
				<div class="card-header"><h4>Distanza</h4></div>
				<div class="card-body">
									
					<p class="text-success lead"><b>Misurata: </b></p> 
					<div id ="divDistanza">
					
					</div>
					<br>
					
					<p class="text-warning lead"><b>Impostata: </b></p> 
					<div id="divDistanzaImpostata">
					
					</div>
					
					<br>
					<button type="button" onclick="toggle_visibility('cambia');stopTimer();" class="btn btn-primary btn-sm"><b>Cambia</b></button>

					<div style="display:none" id = "cambia">
					  
					  <br>
					  <p class="text-info"><b>Inserisci la distanza da impostare:</b></p>
					  <input id="inputDistanza" type="text" ><br>
					  <br>
					  <button type="button" class="btn rounded-pill btn-light button-border-white" onclick=" makeRequest('/impostaDistanza?distanza=' + retrieveValue('inputDistanza')); toggle_visibility('cambia');" value="Imposta Distanza">Imposta</button>
					  
					</div>
				
				</div> <!--  CHIUDE IL BODY DELLA CARD -->
			  </div> <!-- CHIUDE LA CARD -->
			</div> <!-- CHIUDE ALTRO D INLINE FLEX -->
		</div> <!-- CHIUDE FLOAT RIGHT -->
	</div>   <!-- CHIUDE D FLEX CONTENITORE -->
	 
	  
	<div class="jumbotron">
		<div class="column">
	   
			<div id="divLuminosita">
			
			</div>
		   
			<div class="d-inline-flex">
		  
				<div class="card rounded-pill text-white bg-warning mb-3 border-white" id="divStateLuceLetto"> 
		  
					<div class="card-body "> <h4 class="card-title">Letto</h4>
					
						<button type="button" class="btn rounded-pill btn-success btn-sm " id="ultimoMovimento" ><b>Ultimo movimento: </b></button>	
						<br><br>
						<span class="badge badge-pill badge-light" id="labelLuceLetto"><b>Luce accesa</b></span>
										
						<div id="divControlloAutomatico">
				  
						</div>
				  
						<div id="divControlloAutomaticoLuminosita">
					
						</div>
						
						<div id="divControlloSincronoConScrivania">
					
						</div>
						
						<div id="formTimer" style="display-none">
							<br>
							<button type="button" class="btn rounded-pill btn-info btn-sm " id="buttonTimer" onclick="cambiaTesto();toggle_visibility('cambiatimer');" ><b>Timer spegnimento: </b></button>
						
							<div style="display:none" id = "cambiatimer">
													
								<br><b>Dopo quanti minuti vuoi che si spegna la luce?</b><br><br>
								<input id="timerValue" type="text" name="timer" value="1"><br><br>
								
								<button type="button" class="btn rounded-pill btn-light btn-sm " onclick=" makeRequest('/impostaTimer?timer=' + retrieveValue('timerValue')); toggle_visibility('cambiatimer');" ><b>Imposta Timer</b></button>
					
							</div>
						</div>

						<br><br>
					</div> <!-- chiude card body -->
				</div> <!-- chiude div card -->
			  
		   </div> <!-- d-inline-flex affianco jumbotron-->
		</div> <!-- chiude column -->
	   
	</div> <!-- chiude jumbotron -->
	  
	
  <br><br>
    
  </div>
   
  <script>
    
  function reboot(){
		if(confirm("Sei sicuro di voler riavviare il server?")){
			var xmlHttp = new XMLHttpRequest();
			xmlHttp.open( "GET", "/Riavvia", true ); // synchronous request
			xmlHttp.send( null );
			alert("Server riavviato!");
		}
	}
    
	function toggle_visibility(id) {
	  var e = document.getElementById(id);
	  if(e.style.display == 'block')e.style.display = 'none';
	  else e.style.display = 'block';
	}

	function cambiaTesto(){
		if( document.getElementById('buttonTimer').innerHTML == 'Cambia'){
			document.getElementById('buttonTimer').innerHTML = '<b>Annulla</b>'; 	
		} 
		else if( document.getElementById('buttonTimer').innerHTML == 'Annulla'){
			document.getElementById('buttonTimer').innerHTML = '<b>Cambia</b>'; 
		} 
	}
	
	function retrieveValue(element){
		return document.getElementById(element).value;
	}
	
  var interId = setInterval(getJsonInfo, 1000);
  
  function makeRequest(address){
	var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			response = this.responseText;
		}
    };
    xhttp.open("GET", address);
    xhttp.send();
  }

  function getJsonInfo(){ 
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        jsonInput = this.responseText;
        document.getElementById("jsonInfo").innerHTML = jsonInput;
		parseJson(jsonInput);
      }
    };
    xhttp.open("GET", "/getJsonServerLetto");
	
    xhttp.send();
  }
  
  var jsonInput = "";
	
  var stateLuceLetto;
  var controlloAutomatico;
  var controlloAutomaticoLuminosita;
  var timerLuceLetto;
  
  function parseJson(jsonInput){
	const obj = JSON.parse(jsonInput);
	<!-- console.log(obj); -->
	
	<!-- memoria = obj["MEMORIA_DISPONIBILE"]; -->
	<!-- document.getElementById("buttonMemoria").innerHTML = "<strong>Memoria disponibile: </strong>" + memoria; --> -->
	
	orario = obj["ORARIO"];
	document.getElementById("buttonOrario").innerHTML = "<b>" + orario + "</b>";
	
	oraServerOnline = obj["ORA_SERVER_ONLINE"];
	document.getElementById("oraServerOnline").innerHTML = "<b>" + oraServerOnline + "</b>";
	
	luminosita = obj["LUMINOSITA"];
	document.getElementById("divLuminosita").innerHTML = "<h3>Luminosit&#225: <p class=\"text-white\">" + luminosita + "</p></h3>";
	 	
	stateLuceLetto = obj["STATE_LUCE_LETTO"];
	if( stateLuceLetto == 1){
		document.getElementById("divStateLuceLetto").classList.remove("bg-info");
		document.getElementById("divStateLuceLetto").classList.add("bg-warning");
		
		document.getElementById("buttonTimer").classList.remove("btn-warning");
		document.getElementById("buttonTimer").classList.add("btn-info");
				
		document.getElementById("labelLuceLetto").innerHTML = "<b>Luce accesa</b>";
		
	}
	else {
		document.getElementById("divStateLuceLetto").classList.remove("bg-warning");
		document.getElementById("divStateLuceLetto").classList.add("bg-info");
		
		document.getElementById("buttonTimer").classList.remove("btn-info");
		document.getElementById("buttonTimer").classList.add("btn-warning");
		
		document.getElementById("labelLuceLetto").innerHTML = "<b>Luce spenta</b>";
	}
	
	controlloAutomatico = obj["CONTROLLO_AUTOMATICO"];
	if( controlloAutomatico == 0){
		document.getElementById("divControlloAutomatico").innerHTML = "" +
			"<br><br><button type=\"button\" class=\"btn rounded-pill btn-danger btn-sm \" onclick=\"makeRequest('/accendiLuceLetto')\"><b>Accendi</b></button> " +
			"<button type=\"button\" class=\"btn rounded-pill btn-success btn-sm \" onclick=\"makeRequest('/spegniLuceLetto')\" ><b>Spegni</b></button> " +
			"<button type=\"button\" class=\"btn rounded-pill btn-primary btn-sm \" onclick=\"makeRequest('/abilitaControlloAutomatico')\" ><b>Automatizza</b></button>";
			
		document.getElementById("formTimer").style.display = "none";
		
		
	}
	else {
		document.getElementById("divControlloAutomatico").innerHTML = "<br><br><button type=\"button\" class=\"btn rounded-pill btn-dark btn-sm text-white \" onclick=\"makeRequest('/disabilitaControlloAutomatico')\" ><b>Disabilita controllo automatico</b></button>";
				
		document.getElementById("formTimer").style.display = "block";
		
	}
	
		
	controlloAutomaticoLuminosita = obj["CONTROLLO_AUTOMATICO_LUMINOSITA"];
	if( controlloAutomaticoLuminosita == 0){
	
		document.getElementById("divControlloAutomatico").style.display = "block";
		document.getElementById("divControlloAutomaticoLuminosita").innerHTML = "<br><button type=\"button\" class=\"btn rounded-pill btn-light btn-sm \" onclick=\"makeRequest('/abilitaControlloAutomaticoLuminosita')\" ><b>Automatizza luminosit&#225</b></button> ";
    }
	else{
		document.getElementById("divControlloAutomatico").style.display = "none";
		document.getElementById("divControlloAutomaticoLuminosita").innerHTML = "<br><button type=\"button\" class=\"btn rounded-pill btn-light btn-sm \" onclick=\"makeRequest('/disabilitaControlloAutomaticoLuminosita')\" ><b>Disabilita controllo luminosit&#225</b></button> ";
	}
	
	
	controlloSincronoConScrivania = obj["CONTROLLO_SINCRONO_CON_SCRIVANIA"];
	if( controlloSincronoConScrivania == 0){
	
		document.getElementById("divControlloSincronoConScrivania").innerHTML = "<br><button type=\"button\" class=\"btn rounded-pill btn-primary btn-sm text-white\" onclick=\"makeRequest('/abilitaControlloSincronoConScrivania')\" ><b>Abilita Sincronia con luce Scrivania</b></button> ";
    }
	else{

		document.getElementById("divControlloSincronoConScrivania").innerHTML = "<br><button type=\"button\" class=\"btn rounded-pill btn-primary btn-sm text-white\" onclick=\"makeRequest('/disabilitaControlloSincronoConScrivania')\" ><b>Disabilita Sincronia con luce Scrivania</b></button> ";
	}
	
	
	timerLuceLetto = obj["TIMER_LUCE_LETTO"];
	document.getElementById("buttonTimer").innerHTML = " <b>Timer spegnimento: " + timerLuceLetto + "</b>";
	if( timerLuceLetto == 1){
		document.getElementById("buttonTimer").innerHTML += "<b> minuto </b>";
	}
    else{
		document.getElementById("buttonTimer").innerHTML += "<b> minuti </b>";
	}
	
		
	ultimoMovimento = obj["ULTIMO_MOVIMENTO"];
	document.getElementById("ultimoMovimento").innerHTML = "<b>Ultimo movimento: " + ultimoMovimento;
	
	distanzaImpostata = obj["DISTANZA_IMPOSTATA"];
	document.getElementById("divDistanzaImpostata").innerHTML = "<b>" + distanzaImpostata + " CM</b>";
	
	distanza = obj["DISTANZA"];
	document.getElementById("divDistanza").innerHTML = "<b>" + distanza + " CM</b>";
	
  }
  
  
  </script>
</body>
</html>
